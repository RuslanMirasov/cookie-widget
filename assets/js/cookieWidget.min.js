const CookieWidget={init(e){this.settings=e;let t=localStorage.getItem("cookieConsent");!t&&(this.filteredData=[...this.settings.cookieData],this.createInitialConsentState(),this.render(),this.applyStyles(),this.applyUrls(),this.bindEvents())},bindEvents(){this.bindStaticElementsEvents(),this.bindAccordeonEvents(),this.bindFilterFormSubmitEvent(),this.bindSearchField()},bindSearchField(){let e=document.querySelector("[data-widget-search-field]");if(!e)return;let t=this.debounce(e=>{let t=e.target.value;this.searchCookies(t)},500);e.addEventListener("input",t)},bindAccordeonEvents(){let e=document.querySelectorAll(".accordion-toggle");e.forEach(e=>{e.addEventListener("click",e=>{let t=e.target.closest(".cookie-widget-accordeons__item").querySelector(".cookie-widget-accordeons__content");t.style.display="flex"===t.style.display?"none":"flex"})})},bindStaticElementsEvents(){let e=document.querySelector('[data-cookie-widget-btn="settings"]'),t=document.querySelectorAll("[data-cookie-widget-close]"),i=document.querySelector(".cookie-widget-popup-backdrop"),o=document.querySelector(".cookie-widget-fix-block"),a=document.querySelector('[data-cookie-widget-btn="confirm"]'),c=document.querySelectorAll('[data-cookie-widget-btn="accept"]'),s=document.querySelectorAll("[data-cookie-widget-nav]"),d=document.querySelectorAll("[data-cookie-widget-page-nav]"),r=document.querySelectorAll('[data-cookie-widget-btn="deny"]'),n=document.querySelectorAll("[data-cookie-widget-checkbox]"),l=document.querySelector("[data-cookie-widget-filter]");a&&a.addEventListener("click",()=>{this.saveConsentState()}),l&&l.addEventListener("click",e=>{e.currentTarget===e.target&&l.classList.toggle("active")}),t.length>0&&i&&t.forEach(e=>e.addEventListener("click",()=>{document.body.classList.remove("locked"),i.classList.remove("active"),o.classList.remove("active")})),e&&i&&e.addEventListener("click",()=>{document.body.classList.add("locked"),i.classList.add("active")}),c.length>0&&c.forEach(e=>{e.addEventListener("click",()=>{this.acceptAllCookies()})}),r.length>0&&r.forEach(e=>{e.addEventListener("click",()=>{this.denyAllCookies()})}),s.length>0&&s.forEach(e=>{e.addEventListener("click",e=>this.changeTab(e))}),d.length>0&&d.forEach(e=>{e.addEventListener("click",e=>this.changePage(e))}),n.length>0&&n.forEach(e=>{e.addEventListener("change",e=>this.handleCheckboxChange(e))}),setTimeout(()=>{o.classList.add("active")},50)},bindFilterFormSubmitEvent(){let e=document.querySelector("[data-cookie-widget-filter-form]");e&&e.addEventListener("submit",t=>{t.preventDefault();let i=[],o=document.querySelector("[data-cookie-widget-filter]"),a=e.querySelectorAll('input[type="checkbox"]:checked');a.forEach(e=>{i.push(e.name)}),o.classList.remove("active"),this.filterByCategories(i)})},handleCheckboxChange(e){let t=e.currentTarget,i=t.getAttribute("data-cookie-widget-checkbox"),o=t.checked;this.consentState[i]=o,this.updateAcceptAllButtonVisibility()},updateAcceptAllButtonVisibility(){let e=document.querySelector("[data-cookie-widget-accept-all]");if(!e)return;let t=this.settings.cookieData.filter(e=>e.selectable),i=t.some(e=>this.consentState[e.slug]);i?e.style.display="none":e.style.display="block"},changeTab(e){e.preventDefault();let t=e.currentTarget,i=t.dataset.cookieWidgetNav,o=document.querySelector("[data-cookie-widget-nav].active"),a=document.querySelector("[data-cookie-widget-tab].active"),c=document.querySelector(`[data-cookie-widget-tab="${i}"]`);o.classList.remove("active"),a.classList.remove("active"),c.classList.add("active"),t.classList.add("active")},changePage(e){e.preventDefault();let t=e.currentTarget.dataset.cookieWidgetPageNav,i=document.querySelector("[data-cookie-page].active"),o=document.querySelector(`[data-cookie-page="${t}"]`);i.classList.remove("active"),o.classList.add("active")},acceptAllCookies(){for(let e in this.consentState)this.consentState[e]=!0;this.saveConsentState()},denyAllCookies(){let e=this.settings.cookieData;for(let t of e)this.consentState[t.slug]=!t.selectable;this.saveConsentState()},saveConsentState(){localStorage.setItem("cookieConsent",JSON.stringify(this.consentState))},render(){this.renderBasicMarkup(),this.renderCategoryNavigation(),this.renderCategoryTabs(),this.renderFilterForm(),this.renderAccordeons(this.settings.cookieData)},renderBasicMarkup(){let e=`
    <div class="cookie-widget-popup-backdrop" lang="ru">
      <div class="cookie-widget-popup">
        <div class="cookie-widget-popup-content">
          <header class="cookie-widget-header">
            <div class="cookie-widget-logo">
              <img src="https://milka.ru/themes/milka/assets/img/footer/logo-sec.png?v=3" alt="site logo" data-widget-logo/>
            </div>
            <h2>Центр настроек конфиденциальности</h2>
          </header>
          <div class="cookie-widget-settings active" data-cookie-page="main">
            <nav>
              <ul data-widget-category-navigation>
                <li data-cookie-widget-nav="tab1" class="cookie-widget-nav active">Ваша конфиденциальность</li>
              </ul>
            </nav>
            <div class="cookie-widget-tabs" data-cookie-widget-tabs>
              <div class="cookie-widget-tab active" data-cookie-widget-tab="tab1">
                <h3>Ваша конфиденциальность</h3>
                <p>
                  Когда вы посещаете какой-либо веб-сайт, он может сохранять информацию в вашем браузере или получать из него данные, в основном в виде
                  файлов cookie. Эта информация может относиться к вам, вашим предпочтениям, вашему устройству или будет использоваться для правильной
                  работы веб-сайта с вашей точки зрения. Такие данные обычно не идентифицируют вас непосредственно, но могут предоставлять вам
                  индивидуализированные возможности работы в интернете. Вы можете отказаться от использования некоторых типов файлов cookie. Нажимайте на
                  заголовки категорий, чтобы узнать подробности и изменить настройки, заданные по умолчанию. Однако вы должны понимать, что блокировка
                  некоторых типов cookie может повлиять на использование вами веб-сайта и ограничить предлагаемые нами услуги.
                </p>
                <a href="#" data-policy-link>Дополнительная информация</a>
              </div>
            </div>
          </div>

          <div class="cookie-widget-settings cookie-widget-settings--info " data-cookie-page="cookieInfo">
            <div class="cookie-witget-filters">
              <button type="button" class="cookie-witget-go-back" data-cookie-widget-page-nav="main">
                <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M6.5 1C6.5 1 1 6.80919 1 7C1 7.19081 6.5 13 6.5 13" stroke="var(--cookie-widget-primary-color)" stroke-width="2" />
                </svg>
                Назад
              </button>
              <div class="cookie-widget-search">
                <input type="text" placeholder="Поиск..." data-widget-search-field/>
                <svg width="23" height="24" viewBox="0 0 23 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <circle cx="10" cy="10" r="9" stroke="var(--cookie-widget-primary-color)" stroke-width="2" />
                  <path
                    d="M21.1561 23.3239C21.5484 23.7126 22.1816 23.7098 22.5703 23.3175C22.9591 22.9252 22.9562 22.292 22.5639 21.9033L21.1561 23.3239ZM16.1953 17L15.4914 17.7103L21.1561 23.3239L21.86 22.6136L22.5639 21.9033L16.8992 16.2897L16.1953 17Z"
                    fill="var(--cookie-widget-primary-color)"
                  />
                </svg>
              </div>
              <div class="cookie-widget-filter" data-cookie-widget-filter>
                <svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M35.7685 0H0L14 18V36L22 30V18L35.7685 0Z" fill="var(--cookie-widget-primary-color)" />
                </svg>
                <div class="cookie-widget-filter-form-wrapper">
                  <form action="#" data-cookie-widget-filter-form>
                    <button type="reset" href="#" class="cookie-widget-filter-clear">Очистить фильтры</button>
                    <button type="submit" data-cookie-widget-btn="filter">Применить</button>
                  </form>
                </div>
              </div>
            </div>
            <div class="cookie-widget-accordeons">



            </div>
          </div>
          <footer data-cookie-widget="buttons">
            <button type="button" data-cookie-widget-btn="confirm" data-cookie-widget-close>Подтвердить выбор</button>
            <button type="button" data-cookie-widget-btn="deny" data-cookie-widget-close>Отклонить всё</button>
            <button type="button" data-cookie-widget-btn="accept" data-cookie-widget-accept-all data-cookie-widget-close>Одобрить всё</button>
          </footer>
        </div>
      </div>
    </div>
    `,t=`
    <div class="cookie-widget-fix-block">
      <p>
        Мы и наши партнеры на этом веб-сайте используем файлы cookies для различных целей, в частности, для облегчения навигации, персонализации контента,
        оценки использования сайта, а также для адаптации рекламы и предоставления наилучшего цифрового опыта. Вы можете дать согласие на использование
        нами файлов cookies, отказаться от использования файлов cookie, кроме случаев, когда это строго необходимо, или управлять своими предпочтениями,
        нажав \xabНастройки файлов cookies\xbb. Узнайте больше в нашем Уведомлении об использовании файлов
        <a href="#" data-policy-link>cookies</a> .
      </p>
      <div data-cookie-widget="buttons">
        <button type="button" data-cookie-widget-btn="settings">Настройки файлов cookies</button>
        <button type="button" data-cookie-widget-btn="deny" data-cookie-widget-close>Отклонить файлы cookies</button>
        <button type="button" data-cookie-widget-btn="accept" data-cookie-widget-close>Принять файлы cookies</button>
      </div>
    </div>
  `;document.body.insertAdjacentHTML("beforeend",e+t)},renderCategoryTabs(){let e=document.querySelector("[data-cookie-widget-tabs]");if(!e)return;let t=this.settings.cookieData;t.forEach(({slug:t,category:i,description:o,selectable:a})=>{let c=a?`
        <div class="cookie-widget-checkbox">
          <input type="checkbox" name="${t}" id="${t}" data-cookie-widget-checkbox="${t}" />
          <label for="${t}"></label>
        </div>
      `:`
        <span class="cookie-widget-absolute-text">Всегда активно</span>
      `,s=`
        <div class="cookie-widget-tab" data-cookie-widget-tab="${t}">
          <h3>${i}</h3>
          ${c}
          <p>${o}</p>
          <a href="#" data-cookie-widget-page-nav="cookieInfo">Сведения о файлах cookie</a>
        </div>
      `;e.insertAdjacentHTML("beforeend",s)})},renderCategoryNavigation(){let e=document.querySelector("[data-widget-category-navigation]");if(!e)return;let t=this.settings.cookieData;t.forEach((t,i)=>{let o=`
        <li data-cookie-widget-nav="${t.slug}" class="cookie-widget-nav">
          ${t.category}
        </li>
      `;e.insertAdjacentHTML("beforeend",o)})},renderFilterForm(){let e=document.querySelector(".cookie-widget-filter-clear");if(!e)return;let t=this.settings.cookieData,i="";t.forEach(({slug:e,category:t})=>{i+=`
      <label>
        <input type="checkbox" name="${e}"/>
        <span>${t}</span>
      </label>
    `}),e.insertAdjacentHTML("afterend",i)},renderAccordeons(e){let t=document.querySelector(".cookie-widget-accordeons");if(t){if(t.innerHTML="",!e||0===e.length){t.innerHTML="<p>Ничего не найдено</p>";return}e.forEach(({category:e,cookies:i})=>{i&&0!==i.length&&i.forEach(i=>{let o="";i.list.forEach(t=>{o+=`
          <div class="cookie-info">
            <p><strong>Имя:</strong> ${t.name}</p>
            <p><strong>Категория:</strong> ${e}</p>
            <p><strong>Описание:</strong> ${t.description}</p>
          </div>
        `});let a=`
        <div class="cookie-widget-accordeons__item">
          <div class="accordion-header accordion-toggle">
            <span>${i.host}</span>
            <svg width="14" height="8" viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M1 1C1 1 6.80919 6.5 7 6.5C7.19081 6.5 13 1 13 1" stroke="var(--cookie-widget-primary-color)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="cookie-widget-accordeons__content">
            ${o}
          </div>
        </div>
      `;t.insertAdjacentHTML("beforeend",a)})})}},filterByCategories(e){Array.isArray(e)&&(0===e.length?this.filteredData=JSON.parse(JSON.stringify(this.settings.cookieData)):this.filteredData=this.settings.cookieData.filter(t=>e.includes(t.slug)),this.renderAccordeons(this.filteredData),this.bindAccordeonEvents())},searchCookies(e){let t=e.trim().toLowerCase();if(!t){this.renderAccordeons(this.filteredData),this.bindAccordeonEvents();return}let i=[];this.filteredData.forEach(e=>{let o=e.cookies.filter(e=>e.host.toLowerCase().includes(t));o.length>0&&i.push({...e,cookies:o})}),this.renderAccordeons(i),this.bindAccordeonEvents()},createInitialConsentState(){this.consentState={};let e=this.settings.cookieData;e.forEach(e=>{this.consentState[e.slug]=!e.selectable})},applyStyles(){let e=document.documentElement,{primaryColor:t,logoBackground:i}=this.settings;t&&e.style.setProperty("--cookie-widget-primary-color",t),i&&e.style.setProperty("--cookie-widget-logo-bg",i)},applyUrls(){let{logoUrl:e,policyUrl:t}=this.settings,i=document.querySelector("[data-widget-logo]");i&&e&&i.setAttribute("src",e);let o=document.querySelectorAll("[data-policy-link]");o.length>0&&t&&o.forEach(e=>e.setAttribute("href",t))},debounce(e,t){let i;return function(...o){clearTimeout(i),i=setTimeout(()=>{e.apply(this,o)},t)}}};